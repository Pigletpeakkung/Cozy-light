<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Master Light Spot</title>
  <style>
    body {
      transition: all 0.3s;
    }
    .cross-button-container {
      text-align: center;
      margin: 20px;
    }
    .cross-button {
      position: relative;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #f0f0f0, #d9d9d9);
      border: none;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      transition: background 0.3s;
    }
    .cross-vertical {
      position: absolute;
      top: 15px;
      left: 50%;
      width: 12px;
      height: 30px;
      background: #333;
      border-radius: 4px;
      transform: translateX(-50%);
    }
    .cross-horizontal {
      position: absolute;
      top: 50%;
      left: 15px;
      width: 30px;
      height: 12px;
      background: #333;
      border-radius: 4px;
      transform: translateY(-50%);
    }
    .cross-button:hover {
      background: linear-gradient(135deg, #e6e6e6, #cccccc);
    }
    .cross-button:hover .cross-vertical,
    .cross-button:hover .cross-horizontal {
      background: #007bff;
    }
    .cross-button.active {
      animation: warmGlow 3s ease-in-out forwards;
    }
    @keyframes warmGlow {
      0% { box-shadow: 0 0 10px #FFD700, 0 0 20px #FFD700; }
      25% { box-shadow: 0 0 10px #FFA500, 0 0 20px #FFA500; }
      50% { box-shadow: 0 0 10px #FF6347, 0 0 20px #FF6347; }
      75% { box-shadow: 0 0 10px #FF4500, 0 0 20px #FF4500; }
      100% { box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); }
    }
    #passageOutput {
      margin: 20px;
      font-style: italic;
      color: #333;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    #audioPlayer {
      margin: 10px;
    }
    #shareButtons a, #shareButtons button {
      padding: 8px 12px;
      background: #f1f1f1;
      text-decoration: none;
      color: #333;
      border-radius: 4px;
      margin: 5px;
      display: inline-block;
    }
    #shareButtons a:hover, #shareButtons button:hover {
      background: #007bff;
      color: #fff;
    }
    #credit {
      font-size: 10px;
      color: #888;
      text-align: center;
      margin-top: 10px;
    }
    footer {
      text-align: center;
      padding: 1rem;
      font-size: 0.9rem;
    }
    footer a {
      color: #007bff;
      text-decoration: none;
    }
    footer a:hover {
      text-decoration: underline;
    }
    .dark-mode {
      background: #333;
      color: #fff;
    }
    .dark-mode .cross-button {
      background: linear-gradient(135deg, #555, #444);
    }
    .dark-mode .cross-vertical, .dark-mode .cross-horizontal {
      background: #fff;
    }
    @media (max-width: 600px) {
      .cross-button {
        width: 50px;
        height: 50px;
      }
      .cross-vertical {
        width: 10px;
        height: 25px;
        top: 12px;
      }
      .cross-horizontal {
        width: 25px;
        height: 10px;
        left: 12px;
      }
      #passageOutput {
        font-size: 0.9rem;
        padding: 0 10px;
      }
    }
  </style>
  <script type="application/ld+json">{
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "WebSite",
        "url": "https://pigletpeakkung.github.io/Cozy-light/",
        "name": "Cozy Light by Thanattsitt S.",
        "description": "A web application for generating inspirational quotes with text-to-speech, sharing, and user customization features, created by Thanattsitt S. under Thann.AI.",
        "publisher": {
          "@type": "Person",
          "name": "Thanattsitt S.",
          "url": "https://pigletpeakkung.github.io",
          "sameAs": []
        },
        "creator": {
          "@type": "Person",
          "name": "Thanattsitt S.",
          "url": "https://pigletpeakkung.github.io"
        },
        "isPartOf": {
          "@type": "Organization",
          "name": "Thann.AI",
          "url": "https://www.pegearts.com/",
          "description": "An AI-related project or personal brand associated with Thanattsitt S."
        },
        "potentialAction": {
          "@type": "ViewAction",
          "target": "https://pigletpeakkung.github.io/Cozy-light/",
          "name": "Explore Inspirational Quotes"
        }
      },
      {
        "@type": "WebApplication",
        "url": "https://pigletpeakkung.github.io/Cozy-light/",
        "name": "Cozy Light Quote Generator",
        "description": "An interactive web application that displays inspirational quotes from various spiritual and philosophical sources, with text-to-speech functionality, social sharing, and user preferences for theme, font size, and animations.",
        "applicationCategory": "Lifestyle",
        "operatingSystem": "Web",
        "featureList": [
          "Random quote generation",
          "Text-to-speech audio playback",
          "Social sharing via Twitter",
          "Favorite quote saving",
          "Category filtering",
          "User preferences (theme, font size, animations)",
          "Offline support via service worker",
          "Daily notifications"
        ],
        "author": {
          "@type": "Person",
          "name": "Thanattsitt S.",
          "url": "https://pigletpeakkung.github.io"
        },
        "contributor": {
          "@type": "Organization",
          "name": "Thann.AI",
          "url": "https://www.pegearts.com/"
        },
        "browserRequirements": "Modern web browser with JavaScript and Web Speech API support",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD",
          "availability": "http://schema.org/InStock"
        },
        "contentRating": "General"
      },
      {
        "@type": "Person",
        "name": "Thanattsitt S.",
        "url": "https://pigletpeakkung.github.io",
        "description": "Creator of the Cozy Light web application, associated with Thann.AI.",
        "sameAs": [],
        "memberOf": {
          "@type": "Organization",
          "name": "Thann.AI",
          "url": "https://www.pegearts.com/"
        }
      },
      {
        "@type": "Organization",
        "name": "Thann.AI",
        "url": "https://www.pegearts.com/",
        "description": "An AI-related project or personal brand led by Thanattsitt S., focusing on innovative web applications.",
        "logo": "https://thann.ai/logo.png",
        "sameAs": []
      }
    ]
  }
  </script>
</head>
<body>
  <div class="cross-button-container">
    <div>
      <label for="themeToggle">Dark Mode</label>
      <input type="checkbox" id="themeToggle" onchange="toggleTheme()">
      <label for="fontSize">Font Size:</label>
      <select id="fontSize" onchange="changeFontSize()">
        <option value="1rem">Small</option>
        <option value="1.2rem" selected>Medium</option>
        <option value="1.4rem">Large</option>
      </select>
      <label for="categoryFilter">Source:</label>
      <select id="categoryFilter" onchange="filterQuotes()">
        <option value="all">All Sources</option>
        <option value="Conversations with God">Conversations with God</option>
        <option value="Seth Speaks">Seth Speaks</option>
        <option value="Rumi">Rumi</option>
        <option value="Alan Watts">Alan Watts</option>
        <option value="Florence Scovel Shinn">Florence Scovel Shinn</option>
        <option value="Lao Tzu">Lao Tzu</option>
        <option value="Law of One">Law of One</option>
        <option value="Emerald Tablet">Emerald Tablet</option>
        <option value="Buddha">Buddha</option>
        <option value="Carl Jung">Carl Jung</option>
        <option value="Edgar Cayce">Edgar Cayce</option>
        <option value="Dr. Joe Dispenza">Dr. Joe Dispenza</option>
        <option value="S.N. Goenka">S.N. Goenka</option>
        <option value="Dolores Cannon">Dolores Cannon</option>
        <option value="Louise Hay">Louise Hay</option>
        <option value="Bhagavad Gita">Bhagavad Gita</option>
        <option value="Quotable API">Quotable API</option>
      </select>
    </div>
    <button aria-label="Generate a new inspirational quote" class="cross-button" id="crossButton" onclick="generatePassage()" role="button">
      <span class="cross-vertical" aria-hidden="true"></span>
      <span class="cross-horizontal" aria-hidden="true"></span>
    </button>
    <div id="passageOutput" role="region" aria-live="polite"></div>
    <div id="audioPlayer"></div>
    <div id="shareButtons"></div>
  </div>
  <div id="credit">Quotes sourced from Conversations with God, Sethfillable, Rumi, Alan Watts, Florence Scovel Shinn, Lao Tzu, Law of One, Emerald Tablet, Buddha, Carl Jung, Edgar Cayce, Dr. Joe Dispenza, S.N. Goenka, Dolores Cannon, Louise Hay, Bhagavad Gita, and Quotable API.</div>

  <footer>
    <p>Â© Thann.AI Project | <a href="https://www.pegearts.com" target="_blank">PegeArts</a> |
       <a href="https://www.linkedin.com/in/thanattsitts" target="_blank">LinkedIn</a> |
       <a href="https://ko-fi.com/ezekielarts" target="_blank">Support on Ko-fi</a></p>
  </footer>

  <script>
    // Passages array (abbreviated; replace with full array from original code)
    let passages = [
      { text: "The present is the opportunity. Make the most of today.", id: 268, source: "Edgar Cayce" },
      { text: "The kingdom of heaven is within. The Christ Consciousness is universal.", id: 269, source: "Edgar Cayce" },
      { text: "All force is one force, all power is one power, all energy is one energy.", id: 270, source: "Edgar Cayce" },
      { text: "We are all fragments of the One Infinite Creator experiencing itself in infinite ways.", id: 271, source: "Dolores Cannon" },
      { text: "You have the power to heal your life, and you need to know that.", id: 291, source: "Louise Hay" },
      { text: "You have the right to perform your prescribed duties, but you are not entitled to the fruits of your actions.", id: 311, source: "Bhagavad Gita" }
      // Add all 673 passages from your original code here
    ];
    let originalPassages = [...passages];
    let usedPassages = JSON.parse(localStorage.getItem('usedPassages')) || [];
    let isGenerating = false;
    let voicesLoaded = false;

    // Service Worker Registration
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').catch(error => console.error('Service Worker registration failed:', error));
    }

    // Fetch quotes from Quotable API
    async function fetchQuotes(limit = 5) {
      try {
        const response = await fetch(`https://api.quotable.io/quotes?tags=inspirational,spirituality&limit=${limit}`);
        const data = await response.json();
        return data.results.map((quote, index) => ({
          text: quote.content,
          id: `api-${index + 100}`,
          source: "Quotable API"
        }));
      } catch (error) {
        console.error('Error fetching quotes:', error);
        return [];
      }
    }

    // Update passages with fetched quotes
    async function updatePassages() {
      const cachedPassages = JSON.parse(localStorage.getItem('passages')) || passages;
      const newQuotes = await fetchQuotes();
      passages = [...cachedPassages, ...newQuotes];
      originalPassages = [...passages];
      localStorage.setItem('passages', JSON.stringify(passages));
    }

    // Voice selection
    window.speechSynthesis.onvoiceschanged = () => {
      voicesLoaded = true;
      populateVoiceList();
    };

    function populateVoiceList() {
      const voices = window.speechSynthesis.getVoices();
      const voiceSelect = document.createElement('select');
      voiceSelect.id = 'voiceSelect';
      voices.forEach(voice => {
        const option = document.createElement('option');
        option.value = voice.name;
        option.textContent = `${voice.name} (${voice.lang})`;
        voiceSelect.appendChild(option);
      });
      const audioPlayer = document.getElementById('audioPlayer');
      if (voices.length) {
        audioPlayer.appendChild(voiceSelect);
      } else {
        audioPlayer.innerHTML = '<p>Text-to-speech is not supported in this browser.</p>';
      }
    }

    // Generate audio
    function generateAudio(text, autoPlay = false) {
      const audioPlayer = document.getElementById('audioPlayer');
      if (!window.speechSynthesis || !window.speechSynthesis.getVoices().length) {
        audioPlayer.innerHTML = '<p>Text-to-speech is not supported in this browser.</p>';
        return;
      }
      audioPlayer.innerHTML = '';

      const createUtterance = () => {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'en-US';
        utterance.pitch = 0.9;
        utterance.rate = 1;
        if (voicesLoaded) {
          const voices = window.speechSynthesis.getVoices();
          const selectedVoice = document.getElementById('voiceSelect')?.value;
          const voice = voices.find(v => v.name === selectedVoice) || voices.find(v => v.lang === 'en-US');
          if (voice) utterance.voice = voice;
        }
        utterance.onerror = (event) => console.error('SpeechSynthesisUtterance error:', event.error);
        return utterance;
      };

      if (autoPlay) {
        window.speechSynthesis.cancel(); // Clear any existing speech queue
        window.speechSynthesis.speak(createUtterance());
      }

      const playButton = document.createElement('button');
      playButton.textContent = 'Play Verse Again';
      playButton.onclick = () => {
        window.speechSynthesis.cancel(); // Clear any ongoing speech
        window.speechSynthesis.speak(createUtterance());
      };
      audioPlayer.appendChild(playButton);
    }

    // Generate sharing buttons
    function generateShareButtons(text, id, source) {
      const shareButtons = document.getElementById('shareButtons');
      shareButtons.innerHTML = '';

      const encodedText = encodeURIComponent(text);
      const shareData = {
        title: 'God Speaking to You',
        text: text,
        url: window.location.href
      };

      if (navigator.share) {
        const shareBtn = document.createElement('button');
        shareBtn.textContent = 'Share Verse';
        shareBtn.onclick = () => navigator.share(shareData).catch(err => console.error('Share error:', err));
        shareButtons.appendChild(shareBtn);
      }

      const favoriteBtn = document.createElement('button');
      favoriteBtn.textContent = 'Save as Favorite';
      favoriteBtn.onclick = () => saveFavorite(text, id, source);
      shareButtons.appendChild(favoriteBtn);

      const platforms = [
        { name: 'X', url: `https://x.com/intent/post?text=${encodedText}` },
        { name: 'Facebook', url: `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareData.url)}&quote=${encodedText}` },
        { name: 'WhatsApp', url: `https://api.whatsapp.com/send?text=${encodedText}` },
        { name: 'Email', url: `mailto:?subject=${encodeURIComponent(shareData.title)}&body=${encodedText}%0A${shareData.url}` }
      ];

      platforms.forEach(platform => {
        const btn = document.createElement('a');
        btn.href = platform.url;
        btn.textContent = `Share on ${platform.name}`;
        shareButtons.appendChild(btn);
      });
    }

    // Save favorite quote
    function saveFavorite(text, id, source) {
      const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
      if (!favorites.some(f => f.id === id)) {
        favorites.push({ text, id, source });
        localStorage.setItem('favorites', JSON.stringify(favorites));
        alert('Quote saved to favorites!');
      } else {
        alert('This quote is already in your favorites.');
      }
    }

    // Filter quotes by source
    function filterQuotes() {
      const selectedSource = document.getElementById('categoryFilter').value;
      if (selectedSource === 'all') {
        passages = [...originalPassages];
      } else {
        passages = originalPassages.filter(p => p.source === selectedSource);
      }
      usedPassages = [];
      localStorage.setItem('usedPassages', JSON.stringify(usedPassages));
      generatePassage();
    }

    // Generate a non-repeating random passage
    function generatePassage() {
      if (isGenerating) return;
      isGenerating = true;

      const button = document.getElementById('crossButton');
      button.classList.add('active');
      setTimeout(() => {
        button.classList.remove('active');
        isGenerating = false;
      }, 3000);

      let availablePassages = passages.filter(p => !usedPassages.includes(p.id));
      if (availablePassages.length === 0) {
        usedPassages = [];
        availablePassages = passages;
      }

      const randomPassage = availablePassages[Math.floor(Math.random() * availablePassages.length)];
      usedPassages.push(randomPassage.id);
      localStorage.setItem('usedPassages', JSON.stringify(usedPassages));

      document.getElementById('passageOutput').innerHTML = `<p>"${randomPassage.text}"${randomPassage.source ? `<br><small>Source: ${randomPassage.source}</small>` : ''}</p>`;
      generateAudio(randomPassage.text, true);
      generateShareButtons(randomPassage.text, randomPassage.id, randomPassage.source);
    }

    // Theme toggle
    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
    }

    // Font size adjustment
    function changeFontSize() {
      const size = document.getElementById('fontSize').value;
      document.getElementById('passageOutput').style.fontSize = size;
      localStorage.setItem('fontSize', size);
    }

    // Load saved preferences
    if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('dark-mode');
      document.getElementById('themeToggle').checked = true;
    }
    if (localStorage.getItem('fontSize')) {
      document.getElementById('fontSize').value = localStorage.getItem('fontSize');
      document.getElementById('passageOutput').style.fontSize = localStorage.getItem('fontSize');
    }

    // Keyboard navigation
    document.getElementById('crossButton').addEventListener('keydown', (event) => {
      if (event.key === 'Enter' || event.key === ' ') {
        generatePassage();
      }
    });

    // Daily notifications
    if (Notification.permission === 'granted') {
      setInterval(() => {
        const randomPassage = passages[Math.floor(Math.random() * passages.length)];
        new Notification('Daily Inspiration', { body: randomPassage.text });
      }, 24 * 60 * 60 * 1000);
    } else if (Notification.permission !== 'denied') {
      Notification.requestPermission();
    }

    // Initialize
    updatePassages();
    generatePassage();
  </script>
</body>
      </html>
