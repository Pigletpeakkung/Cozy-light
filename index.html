<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Master Light Spot</title>
  <style>
    body {
      transition: all 0.3s;
    }
    .cross-button-container {
      text-align: center;
      margin: 20px;
    }
    .cross-button {
      position: relative;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #f0f0f0, #d9d9d9);
      border: none;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      transition: background 0.3s;
    }
    .cross-vertical {
      position: absolute;
      top: 15px;
      left: 50%;
      width: 12px;
      height: 30px;
      background: #333;
      border-radius: 4px;
      transform: translateX(-50%);
    }
    .cross-horizontal {
      position: absolute;
      top: 50%;
      left: 15px;
      width: 30px;
      height: 12px;
      background: #333;
      border-radius: 4px;
      transform: translateY(-50%);
    }
    .cross-button:hover {
      background: linear-gradient(135deg, #e6e6e6, #cccccc);
    }
    .cross-button:hover .cross-vertical,
    .cross-button:hover .cross-horizontal {
      background: #007bff;
    }
    .cross-button.active {
      animation: warmGlow 3s ease-in-out forwards;
    }
    @keyframes warmGlow {
      0% { box-shadow: 0 0 10px #FFD700, 0 0 20px #FFD700; }
      25% { box-shadow: 0 0 10px #FFA500, 0 0 20px #FFA500; }
      50% { box-shadow: 0 0 10px #FF6347, 0 0 20px #FF6347; }
      75% { box-shadow: 0 0 10px #FF4500, 0 0 20px #FF4500; }
      100% { box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); }
    }
    #passageOutput {
      margin: 20px;
      font-style: italic;
      color: #333;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    #audioPlayer {
      margin: 10px;
    }
    #shareButtons a, #shareButtons button {
      padding: 8px 12px;
      background: #f1f1f1;
      text-decoration: none;
      color: #333;
      border-radius: 4px;
      margin: 5px;
      display: inline-block;
    }
    #shareButtons a:hover, #shareButtons button:hover {
      background: #007bff;
      color: #fff;
    }
    #credit {
      font-size: 0.9rem;
      color: #666;
      text-align: center;
      margin: 20px auto;
      padding: 10px;
      max-width: 600px;
      border-radius: 5px;
      background: rgba(0, 0, 0, 0.05);
      border: 1px solid rgba(0, 0, 0, 0.1);
    }
    .dark-mode #credit {
      color: #ccc;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    footer {
      text-align: center;
      padding: 1.5rem;
      font-size: 0.9rem;
      background: linear-gradient(135deg, #f5f5f5, #e0e0e0);
      border-top: 1px solid rgba(0, 0, 0, 0.1);
    }
    .dark-mode footer {
      background: linear-gradient(135deg, #444, #333);
      border-top: 1px solid rgba(255, 255, 255, 0.2);
    }
    footer .gradient-text {
      background: linear-gradient(90deg, #FFD700, #FF4500);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-fill-color: transparent;
      font-weight: bold;
    }
    footer a {
      color: #007bff;
      text-decoration: none;
      margin: 0 10px;
      transition: color 0.3s ease;
    }
    footer a:hover {
      color: #FF4500;
      text-decoration: underline;
    }
    .dark-mode footer a {
      color: #66b0ff;
    }
    .dark-mode footer a:hover {
      color: #FFD700;
    }
    .dark-mode {
      background: #333;
      color: #fff;
    }
    .dark-mode .cross-button {
      background: linear-gradient(135deg, #555, #444);
    }
    .dark-mode .cross-vertical, .dark-mode .cross-horizontal {
      background: #fff;
    }
    @media (max-width: 600px) {
      .cross-button {
        width: 50px;
        height: 50px;
      }
      .cross-vertical {
        width: 10px;
        height: 25px;
        top: 12px;
      }
      .cross-horizontal {
        width: 25px;
        height: 10px;
        left: 12px;
      }
      #passageOutput {
        font-size: 0.9rem;
        padding: 0 10px;
      }
      #credit {
        font-size: 0.8rem;
        padding: 8px;
      }
      footer {
        padding: 1rem;
        font-size: 0.8rem;
      }
      footer a {
        margin: 0 5px;
      }
    }
  </style>
  <script type="application/ld+json">{
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "WebSite",
        "url": "https://pigletpeakkung.github.io/Cozy-light/",
        "name": "Cozy Light by Thanattsitt S.",
        "description": "A web application for generating inspirational quotes with text-to-speech, sharing, and user customization features, created by Thanattsitt S. under Thann.AI.",
        "publisher": {
          "@type": "Person",
          "name": "Thanattsitt S.",
          "url": "https://pigletpeakkung.github.io",
          "sameAs": []
        },
        "creator": {
          "@type": "Person",
          "name": "Thanattsitt S.",
          "url": "https://pigletpeakkung.github.io"
        },
        "isPartOf": {
          "@type": "Organization",
          "name": "Thann.AI",
          "url": "https://www.pegearts.com/",
          "description": "An AI-related project or personal brand associated with Thanattsitt S."
        },
        "potentialAction": {
          "@type": "ViewAction",
          "target": "https://pigletpeakkung.github.io/Cozy-light/",
          "name": "Explore Inspirational Quotes"
        }
      },
      {
        "@type": "WebApplication",
        "url": "https://pigletpeakkung.github.io/Cozy-light/",
        "name": "Cozy Light Quote Generator",
        "description": "An interactive web application that displays inspirational quotes from various spiritual and philosophical sources, with text-to-speech functionality, social sharing, and user preferences for theme, font size, and animations.",
        "applicationCategory": "Lifestyle",
        "operatingSystem": "Web",
        "featureList": [
          "Random quote generation",
          "Text-to-speech audio playback",
          "Social sharing via Twitter",
          "Favorite quote saving",
          "Category filtering",
          "User preferences (theme, font size, animations)",
          "Offline support via service worker",
          "Daily notifications"
        ],
        "author": {
          "@type": "Person",
          "name": "Thanattsitt S.",
          "url": "https://pigletpeakkung.github.io"
        },
        "contributor": {
          "@type": "Organization",
          "name": "Thann.AI",
          "url": "https://www.pegearts.com/"
        },
        "browserRequirements": "Modern web browser with JavaScript and Web Speech API support",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD",
          "availability": "http://schema.org/InStock"
        },
        "contentRating": "General"
      },
      {
        "@type": "Person",
        "name": "Thanattsitt S.",
        "url": "https://pigletpeakkung.github.io",
        "description": "Creator of the Cozy Light web application, associated with Thann.AI.",
        "sameAs": [],
        "memberOf": {
          "@type": "Organization",
          "name": "Thann.AI",
          "url": "https://www.pegearts.com/"
        }
      },
      {
        "@type": "Organization",
        "name": "Thann.AI",
        "url": "https://www.pegearts.com/",
        "description": "An AI-related project or personal brand led by Thanattsitt S., focusing on innovative web applications.",
        "logo": "https://thann.ai/logo.png",
        "sameAs": []
      }
    ]
  }
  </script>
</head>
<body>
  <div class="cross-button-container">
    <div>
      <label for="themeToggle">Dark Mode</label>
      <input type="checkbox" id="themeToggle" onchange="toggleTheme()">
      <label for="fontSize">Font Size:</label>
      <select id="fontSize" onchange="changeFontSize()">
        <option value="1rem">Small</option>
        <option value="1.2rem" selected>Medium</option>
        <option value="1.4rem">Large</option>
      </select>
      <label for="categoryFilter">Source:</label>
      <select id="categoryFilter" onchange="filterQuotes()">
        <option value="all">All Sources</option>
        <option value="Conversations with God">Conversations with God</option>
        <option value="Seth Speaks">Seth Speaks</option>
        <option value="Rumi">Rumi</option>
        <option value="Alan Watts">Alan Watts</option>
        <option value="Buddha">Buddha</option>
        <option value="Lao Tzu, Tao Te Ching">Lao Tzu, Tao Te Ching</option>
        <option value="Quotable API">Quotable API</option>
      </select>
    </div>
    <button aria-label="Generate a new inspirational quote" class="cross-button" id="crossButton" onclick="generatePassage()" role="button">
      <span class="cross-vertical" aria-hidden="true"></span>
      <span class="cross-horizontal" aria-hidden="true"></span>
    </button>
    <div id="passageOutput" role="region" aria-live="polite"></div>
    <div id="audioPlayer"></div>
    <div id="shareButtons"></div>
  </div>
  <div id="credit">Quotes sourced from Conversations with God, Seth Speaks, Rumi, Alan Watts, Buddha, Lao Tzu, and Quotable API.</div>

  <footer role="contentinfo">
    <p><span class="gradient-text">© Thann.AI Project</span> | 
       <a href="https://www.pegearts.com" target="_blank" aria-label="Visit PegeArts website">PegeArts</a> |
       <a href="https://www.linkedin.com/in/thanattsitts" target="_blank" aria-label="Visit Thanattsitt S. LinkedIn profile">LinkedIn</a> |
       <a href="https://ko-fi.com/ezekielarts" target="_blank" aria-label="Support on Ko-fi">Support on Ko-fi</a></p>
  </footer>

  <script>
    // Passages array (90 quotes as provided)
    let passages = [
      // Conversations with God (15 quotes)
      { text: "This is the real secret of life—to be completely engaged with what you are doing in the here and now. And instead of calling it work, realize it is play.", id: 001, source: "Alan Watts, The Wisdom of Insecurity" },
  { text: "You didn't come into this world. You came out of it, like a wave from the ocean. You are not a stranger here.", id: 002, source: "Alan Watts, The Book: On the Taboo Against Knowing Who You Are" },
  { text: "A person who thinks all the time has nothing to think about except thoughts. So, he loses touch with reality and lives in a world of illusions.", id: 003, source: "Alan Watts, Lecture on Zen" },
  { text: "Life as it is should be enough of a reason to laugh. It is so absurd, it is so ridiculous. It is so beautiful, it is so wonderful.", id: 004, source: "Alan Watts, Out of Your Mind" },
  { text: "For man is always bound so long as he depends for his happiness on a partial experience.", id: 005, source: "Alan Watts, The Way of Zen" },
  { text: "The more a thing tends to be permanent, the more it tends to be lifeless.", id: 006, source: "Alan Watts, Become What You Are" },
  { text: "No one is more dangerously insane than one who is sane all the time: he is like a steel bridge without flexibility.", id: 007, source: "Alan Watts, The Joyous Cosmology" },
  { text: "Life exists only at this very moment, and in this moment it is infinite and eternal.", id: 008, source: "Alan Watts, The Wisdom of Insecurity" },
  { text: "Muddy water is best cleared by leaving it alone.", id: 009, source: "Alan Watts, The Way of Zen" },
  { text: "Man suffers only because he takes seriously what the gods made for fun.", id: 010, source: "Alan Watts, The Book: On the Taboo Against Knowing Who You Are" }
],
      { text: "You are God, in drag.", id: 1, source: "Conversations with God" },
      { text: "There is no such thing as a better way, only another way.", id: 2, source: "Conversations with God" },
      { text: "The soul creates, the mind reacts, the body experiences.", id: 3, source: "Conversations with God" },
      { text: "All human actions are motivated at their deepest level by one of two emotions: fear or love.", id: 4, source: "Conversations with God" },
      { text: "There are no victims in the universe—only creators.", id: 5, source: "Conversations with God" },
      { text: "Your life is not about you, it is about everyone whose life you touch.", id: 6, source: "Conversations with God" },
      { text: "The purpose of relationship is not to have another who might complete you, but to have another with whom you might share your completeness.", id: 7, source: "Conversations with God" },
      { text: "There is only one purpose for all of life, and that is for you and all that lives to experience fullest glory.", id: 8, source: "Conversations with God" },
      { text: "You are the creator of your own reality, and life can show up no other way for you than that way in which you think it will.", id: 9, source: "Conversations with God" },
      { text: "The truth is simple: There is no separation between you and God.", id: 10, source: "Conversations with God" },
      { text: "Your way of being is your way of believing, and your way of believing creates your experience.", id: 11, source: "Conversations with God" },
      { text: "The moment you declare anything, everything unlike it will come into the space.", id: 12, source: "Conversations with God" },
      { text: "There is no truth except the truth that exists within you.", id: 13, source: "Conversations with God" },
      { text: "You are the one who calls the light into being. Indeed, you are the light.", id: 14, source: "Conversations with God" },
      { text: "The deepest secret is that life is not a process of discovery, but a process of creation.", id: 15, source: "Conversations with God" },
      // Seth Speaks (15 quotes)
      { text: "You are not a human being having a spiritual experience. You are a spiritual being having a human experience.", id: 16, source: "Seth Speaks" },
      { text: "The universe is not something apart from you. You are the universe expressing itself as a human for a little while.", id: 17, source: "Seth Speaks" },
      { text: "Your imagination is your gateway to other realities.", id: 18, source: "Seth Speaks" },
      { text: "You create your reality according to your beliefs and expectations.", id: 19, source: "Seth Speaks" },
      { text: "The present is the point of power where past and future meet.", id: 20, source: "Seth Speaks" },
      { text: "You are given the gift of the gods; you create your reality according to your beliefs.", id: 21, source: "Seth Speaks" },
      { text: "The soul is a medium for creativity, a creator that forms realities.", id: 22, source: "Seth Speaks" },
      { text: "You are not at the mercy of past events unless you believe you are.", id: 23, source: "Seth Speaks" },
      { text: "Dreams are the language of the soul.", id: 24, source: "Seth Speaks" },
      { text: "You are more than your physical body. Your consciousness continues when your body dies.", id: 25, source: "Seth Speaks" },
      { text: "Probable realities exist around you like shadows, waiting for your recognition.", id: 26, source: "Seth Speaks" },
      { text: "Your thoughts are as real as your physical objects.", id: 27, source: "Seth Speaks" },
      { text: "You are a multidimensional being, experiencing many realities simultaneously.", id: 28, source: "Seth Speaks" },
      { text: "The answers you seek lie within your own consciousness.", id: 29, source: "Seth Speaks" },
      { text: "Your beliefs shape your health, your relationships, and your world.", id: 30, source: "Seth Speaks" },
      // Rumi (15 quotes)
      { text: "You are not a drop in the ocean. You are the entire ocean in a drop.", id: 31, source: "Rumi" },
      { text: "What you seek is seeking you.", id: 32, source: "Rumi" },
      { text: "Don't grieve. Anything you lose comes round in another form.", id: 33, source: "Rumi" },
      { text: "Let yourself be silently drawn by the strange pull of what you really love.", id: 34, source: "Rumi" },
      { text: "Be like a tree and let the dead leaves drop.", id: 35, source: "Rumi" },
      { text: "The wound is the place where the Light enters you.", id: 36, source: "Rumi" },
      { text: "When you do things from your soul, you feel a river moving in you, a joy.", id: 37, source: "Rumi" },
      { text: "Your task is not to seek for love, but merely to seek and find all the barriers within yourself that you have built against it.", id: 38, source: "Rumi" },
      { text: "Why do you stay in prison when the door is so wide open?", id: 39, source: "Rumi" },
      { text: "Be a lamp, or a lifeboat, or a ladder.", id: 40, source: "Rumi" },
      { text: "Where there is ruin, there is hope for a treasure.", id: 41, source: "Rumi" },
      { text: "Let the beauty of what you love be what you do.", id: 42, source: "Rumi" },
      { text: "The universe is not outside of you. Look inside yourself; everything that you want, you already are.", id: 43, source: "Rumi" },
      { text: "You were born with wings. Why prefer to crawl through life?", id: 44, source: "Rumi" },
      { text: "Sell your cleverness and buy bewilderment.", id: 45, source: "Rumi" },
      // Alan Watts (15 quotes)
      { text: "You are an aperture through which the universe is looking at and exploring itself.", id: 46, source: "Alan Watts" },
      { text: "The only way to make sense out of change is to plunge into it, move with it, and join the dance.", id: 47, source: "Alan Watts" },
      { text: "Trying to define yourself is like trying to bite your own teeth.", id: 48, source: "Alan Watts" },
      { text: "You are that vast thing that you see far, far off with great telescopes.", id: 49, source: "Alan Watts" },
      { text: "This is the real secret of life—to be completely engaged with what you are doing in the here and now.", id: 50, source: "Alan Watts" },
      { text: "The more a thing tends to be permanent, the more it tends to be lifeless.", id: 51, source: "Alan Watts" },
      { text: "We do not 'come into' this world; we come out of it, as leaves from a tree.", id: 52, source: "Alan Watts" },
      { text: "No one is more dangerously insane than one who is sane all the time.", id: 53, source: "Alan Watts" },
      { text: "Muddy water is best cleared by leaving it alone.", id: 54, source: "Alan Watts" },
      { text: "The ego is nothing other than the focus of conscious attention.", id: 55, source: "Alan Watts" },
      { text: "You are under no obligation to be the same person you were five minutes ago.", id: 56, source: "Alan Watts" },
      { text: "Problems that remain persistently insoluble should always be suspected as questions asked in the wrong way.", id: 57, source: "Alan Watts" },
      { text: "The art of living is neither careless drifting nor fearful clinging, but a dance.", id: 58, source: "Alan Watts" },
      { text: "What you are basically, deep deep down, is simply the fabric and structure of existence itself.", id: 59, source: "Alan Watts" },
      { text: "The meaning of life is just to be alive. It is so plain and so obvious and so simple.", id: 60, source: "Alan Watts" },
      // Buddhist Teachings (15 quotes)
      { text: "Do not dwell in the past, do not dream of the future, concentrate the mind on the present moment.", id: 61, source: "Buddha" },
      { text: "Peace comes from within. Do not seek it without.", id: 62, source: "Buddha" },
      { text: "Holding onto anger is like drinking poison and expecting the other person to die.", id: 63, source: "Buddhist proverb" },
      { text: "Thousands of candles can be lit from a single candle, and the life of the candle will not be shortened.", id: 64, source: "Buddha" },
      { text: "You yourself, as much as anybody in the entire universe, deserve your love and affection.", id: 65, source: "Buddha" },
      { text: "In the end, only three things matter: how much you loved, how gently you lived, and how gracefully you let go.", id: 66, source: "Buddhist saying" },
      { text: "The root of suffering is attachment.", id: 67, source: "Buddha" },
      { text: "There is no path to happiness: happiness is the path.", id: 68, source: "Buddha" },
      { text: "All that we are is the result of what we have thought.", id: 69, source: "Buddha" },
      { text: "Better than a thousand hollow words is one word that brings peace.", id: 70, source: "Buddha" },
      { text: "Just as a snake sheds its skin, we must shed our past over and over again.", id: 71, source: "Buddha" },
      { text: "The mind is everything. What you think you become.", id: 72, source: "Buddha" },
      { text: "To understand everything is to forgive everything.", id: 73, source: "Buddha" },
      { text: "No one saves us but ourselves. No one can and no one may. We ourselves must walk the path.", id: 74, source: "Buddha" },
      { text: "Work out your own salvation. Do not depend on others.", id: 75, source: "Buddha" },
      // Tao Te Ching (15 quotes)
      { text: "The Tao that can be told is not the eternal Tao.", id: 76, source: "Lao Tzu, Tao Te Ching" },
      { text: "Nature does not hurry, yet everything is accomplished.", id: 77, source: "Lao Tzu, Tao Te Ching" },
      { text: "When I let go of what I am, I become what I might be.", id: 78, source: "Lao Tzu, Tao Te Ching" },
      { text: "A good traveler has no fixed plans and is not intent on arriving.", id: 79, source: "Lao Tzu, Tao Te Ching" },
      { text: "Knowing others is intelligence; knowing yourself is true wisdom.", id: 80, source: "Lao Tzu, Tao Te Ching" },
      { text: "The soft overcomes the hard; the gentle overcomes the rigid.", id: 81, source: "Lao Tzu, Tao Te Ching" },
      { text: "He who knows he has enough is rich.", id: 82, source: "Lao Tzu, Tao Te Ching" },
      { text: "The journey of a thousand miles begins with one step.", id: 83, source: "Lao Tzu, Tao Te Ching" },
      { text: "When you realize there is nothing lacking, the whole world belongs to you.", id: 84, source: "Lao Tzu, Tao Te Ching" },
      { text: "Silence is a source of great strength.", id: 85, source: "Lao Tzu, Tao Te Ching" },
      { text: "Be content with what you have; rejoice in the way things are.", id: 86, source: "Lao Tzu, Tao Te Ching" },
      { text: "To the mind that is still, the whole universe surrenders.", id: 87, source: "Lao Tzu, Tao Te Ching" },
      { text: "Health is the greatest possession. Contentment is the greatest treasure.", id: 88, source: "Lao Tzu, Tao Te Ching" },
      { text: "Respond intelligently even to unintelligent treatment.", id: 89, source: "Lao Tzu, Tao Te Ching" },
      { text: "New beginnings are often disguised as painful endings.", id: 90, source: "Lao Tzu, Tao Te Ching" }
    ];
    let originalPassages = [...passages];
    let usedPassages = JSON.parse(localStorage.getItem('usedPassages')) || [];
    let isGenerating = false;
    let voicesLoaded = false;

    // Service Worker Registration
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').catch(error => console.error('Service Worker registration failed:', error));
    }

    // Fetch quotes from Quotable API
    async function fetchQuotes(limit = 5) {
      try {
        const response = await fetch(`https://api.quotable.io/quotes?tags=inspirational,spirituality&limit=${limit}`);
        const data = await response.json();
        return data.results.map((quote, index) => ({
          text: quote.content,
          id: `api-${index + 100}`,
          source: "Quotable API"
        }));
      } catch (error) {
        console.error('Error fetching quotes:', error);
        return [];
      }
    }

    // Update passages with fetched quotes
    async function updatePassages() {
      const cachedPassages = JSON.parse(localStorage.getItem('passages')) || passages;
      const newQuotes = await fetchQuotes();
      passages = [...cachedPassages, ...newQuotes];
      originalPassages = [...passages];
      localStorage.setItem('passages', JSON.stringify(passages));
    }

    // Voice selection
    window.speechSynthesis.onvoiceschanged = () => {
      voicesLoaded = true;
      populateVoiceList();
    };

    function populateVoiceList() {
      const voices = window.speechSynthesis.getVoices();
      const voiceSelect = document.createElement('select');
      voiceSelect.id = 'voiceSelect';
      voices.forEach(voice => {
        const option = document.createElement('option');
        option.value = voice.name;
        option.textContent = `${voice.name} (${voice.lang})`;
        voiceSelect.appendChild(option);
      });
      const audioPlayer = document.getElementById('audioPlayer');
      if (voices.length) {
        audioPlayer.appendChild(voiceSelect);
      } else {
        audioPlayer.innerHTML = '<p>Text-to-speech is not supported in this browser.</p>';
      }
    }

    // Generate audio
    function generateAudio(text, autoPlay = false) {
      const audioPlayer = document.getElementById('audioPlayer');
      if (!window.speechSynthesis || !window.speechSynthesis.getVoices().length) {
        audioPlayer.innerHTML = '<p>Text-to-speech is not supported in this browser.</p>';
        return;
      }
      audioPlayer.innerHTML = '';

      const createUtterance = () => {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'en-US';
        utterance.pitch = 0.9;
        utterance.rate = 1;
        if (voicesLoaded) {
          const voices = window.speechSynthesis.getVoices();
          const selectedVoice = document.getElementById('voiceSelect')?.value;
          const voice = voices.find(v => v.name === selectedVoice) || voices.find(v => v.lang === 'en-US');
          if (voice) utterance.voice = voice;
        }
        utterance.onerror = (event) => console.error('SpeechSynthesisUtterance error:', event.error);
        return utterance;
      };

      if (autoPlay) {
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(createUtterance());
      }

      const playButton = document.createElement('button');
      playButton.textContent = 'Play Verse Again';
      playButton.setAttribute('aria-label', 'Play the quote again');
      playButton.onclick = () => {
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(createUtterance());
      };
      audioPlayer.appendChild(playButton);
    }

    // Generate sharing buttons
    function generateShareButtons(text, id, source) {
      const shareButtons = document.getElementById('shareButtons');
      shareButtons.innerHTML = '';

      const encodedText = encodeURIComponent(text);
      const shareData = {
        title: 'God Speaking to You',
        text: text,
        url: window.location.href
      };

      if (navigator.share) {
        const shareBtn = document.createElement('button');
        shareBtn.textContent = 'Share Verse';
        shareBtn.onclick = () => navigator.share(shareData).catch(err => console.error('Share error:', err));
        shareButtons.appendChild(shareBtn);
      }

      const favoriteBtn = document.createElement('button');
      favoriteBtn.textContent = 'Save as Favorite';
      favoriteBtn.onclick = () => saveFavorite(text, id, source);
      shareButtons.appendChild(favoriteBtn);

      const platforms = [
        { name: 'X', url: `https://x.com/intent/post?text=${encodedText}` },
        { name: 'Facebook', url: `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareData.url)}&quote=${encodedText}` },
        { name: 'WhatsApp', url: `https://api.whatsapp.com/send?text=${encodedText}` },
        { name: 'Email', url: `mailto:?subject=${encodeURIComponent(shareData.title)}&body=${encodedText}%0A${shareData.url}` }
      ];

      platforms.forEach(platform => {
        const btn = document.createElement('a');
        btn.href = platform.url;
        btn.textContent = `Share on ${platform.name}`;
        shareButtons.appendChild(btn);
      });
    }

    // Save favorite quote
    function saveFavorite(text, id, source) {
      const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
      if (!favorites.some(f => f.id === id)) {
        favorites.push({ text, id, source });
        localStorage.setItem('favorites', JSON.stringify(favorites));
        alert('Quote saved to favorites!');
      } else {
        alert('This quote is already in your favorites.');
      }
    }

    // Filter quotes by source
    function filterQuotes() {
      const selectedSource = document.getElementById('categoryFilter').value;
      if (selectedSource === 'all') {
        passages = [...originalPassages];
      } else {
        passages = originalPassages.filter(p => p.source === selectedSource);
      }
      usedPassages = [];
      localStorage.setItem('usedPassages', JSON.stringify(usedPassages));
      generatePassage();
    }

    // Generate a non-repeating random passage
    function generatePassage() {
      if (isGenerating) return;
      isGenerating = true;

      const button = document.getElementById('crossButton');
      button.classList.add('active');
      setTimeout(() => {
        button.classList.remove('active');
        isGenerating = false;
      }, 3000);

      let availablePassages = passages.filter(p => !usedPassages.includes(p.id));
      if (availablePassages.length === 0) {
        usedPassages = [];
        availablePassages = passages;
      }

      const randomPassage = availablePassages[Math.floor(Math.random() * availablePassages.length)];
      usedPassages.push(randomPassage.id);
      localStorage.setItem('usedPassages', JSON.stringify(usedPassages));

      document.getElementById('passageOutput').innerHTML = `<p>"${randomPassage.text}"${randomPassage.source ? `<br><small>Source: ${randomPassage.source}</small>` : ''}</p>`;
      generateAudio(randomPassage.text, true);
      generateShareButtons(randomPassage.text, randomPassage.id, randomPassage.source);
    }

    // Theme toggle
    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
    }

    // Font size adjustment
    function changeFontSize() {
      const size = document.getElementById('fontSize').value;
      document.getElementById('passageOutput').style.fontSize = size;
      localStorage.setItem('fontSize', size);
    }

    // Load saved preferences
    if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('dark-mode');
      document.getElementById('themeToggle').checked = true;
    }
    if (localStorage.getItem('fontSize')) {
      document.getElementById('fontSize').value = localStorage.getItem('fontSize');
      document.getElementById('passageOutput').style.fontSize = localStorage.getItem('fontSize');
    }

    // Keyboard navigation
    document.getElementById('crossButton').addEventListener('keydown', (event) => {
      if (event.key === 'Enter' || event.key === ' ') {
        generatePassage();
      }
    });

    // Daily notifications
    if (Notification.permission === 'granted') {
      setInterval(() => {
        const randomPassage = passages[Math.floor(Math.random() * passages.length)];
        new Notification('Daily Inspiration', { body: randomPassage.text });
      }, 24 * 60 * 60 * 1000);
    } else if (Notification.permission !== 'denied') {
      Notification.requestPermission();
    }

    // Initialize
    updatePassages();
    generatePassage();
  </script>
</body>
</html>
